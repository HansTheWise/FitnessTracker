<!DOCTYPE html>
<html lang="de" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker</title>
    <!-- External CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Internal CSS -->
    <style>
        body {
            background-color: #212529;
            color: #dee2e6;
        }

        .nav-link.active {
            font-weight: bold;
        }

        .table {
            --bs-table-bg: #343a40;
            --bs-table-striped-bg: #454d55;
            --bs-table-hover-bg: #4f5861;
            --bs-table-color: #dee2e6;
            --bs-table-border-color: #495057;
        }

        .btn-action {
            width: 40px;
        }

        .dashboard-card {
            background-color: #343a40;
        }

        #toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 1090;
        }

        .toast-notification {
            padding: 1rem 1.5rem;
            border-radius: 0.375rem;
            color: #fff;
            margin-bottom: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-in-out;
        }

        .toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-notification.success {
            background-color: #198754;
        }

        .toast-notification.danger {
            background-color: #dc3545;
        }

        .modal-error-display {
            display: none;
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <div id="toast-container"></div>

    <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="bi bi-heart-pulse-fill text-danger"></i> Fitness Tracker</a>
            <div class="d-flex" id="auth-nav-section"></div>
        </div>
    </nav>

    <main class="container mt-4">
        <!-- Login/Register View -->
        <div id="auth-view" class="container vh-100 d-flex justify-content-center align-items-center">
            <div class="row justify-content-center w-100">
                <div class="col-md-8 col-lg-6">
                    <div class="card bg-dark text-white">
                        <div class="card-body p-5">
                            <h2 id="auth-title" class="card-title text-center mb-4">Anmelden</h2>
                            <form id="auth-form">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email-Adresse</label>
                                    <input type="email" class="form-control" id="email" required />
                                </div>
                                <div class="mb-3">
                                    <label for="password" class="form-label">Passwort</label>
                                    <input type="password" class="form-control" id="password" required />
                                </div>
                                <div class="d-grid">
                                    <button type="submit" id="auth-submit-btn" class="btn btn-primary">Anmelden</button>
                                </div>
                            </form>
                            <div class="text-center mt-3">
                                <button type="button" id="toggle-auth-mode" class="btn btn-link">Noch kein Konto? Jetzt
                                    registrieren.</button>
                            </div>
                            <div id="auth-error" class="text-danger mt-3 text-center"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App View -->
        <div id="app-view" class="d-none">
            <ul class="nav nav-tabs" id="main-tabs" role="tablist">
                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#profile-pane" type="button">Profil</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab"
                        data-bs-target="#dashboard-pane" type="button">Auswertung</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#foods-pane" type="button">Nahrungsmittel</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#exercises-pane" type="button">Bewegungsformen</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#consumptions-pane" type="button">Konsum</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#activities-pane" type="button">Aktivitäten</button></li>
            </ul>
            <div class="tab-content pt-3" id="main-tab-content">
                <!-- Profile Tab -->
                <div class="tab-pane fade" id="profile-pane" role="tabpanel">
                    <h3>Ihr Profil</h3>
                    <p class="text-muted">Ihre Angaben werden zur Berechnung Ihres täglichen Grundumsatzes (BMR)
                        verwendet.</p>
                    <form id="profile-form">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label for="profile-gender"
                                    class="form-label">Geschlecht</label><select id="profile-gender"
                                    class="form-select">
                                    <option value="">Bitte wählen...</option>
                                    <option value="male">Männlich</option>
                                    <option value="female">Weiblich</option>
                                </select></div>
                            <div class="col-md-6 mb-3"><label for="profile-age" class="form-label">Alter
                                    (Jahre)</label><input type="number" id="profile-age" class="form-control" min="1">
                            </div>
                            <div class="col-md-6 mb-3"><label for="profile-height" class="form-label">Größe
                                    (cm)</label><input type="number" id="profile-height" class="form-control" min="1">
                            </div>
                            <div class="col-md-6 mb-3"><label for="profile-weight" class="form-label">Gewicht
                                    (kg)</label><input type="number" id="profile-weight" class="form-control" step="0.1"
                                    min="1"></div>
                            <div class="col-md-6 mb-3"><label for="profile-start-date"
                                    class="form-label">Tracking-Startdatum</label><input type="date"
                                    id="profile-start-date" class="form-control"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Profil speichern</button>
                    </form>
                </div>
                <!-- Dashboard Tab -->
                <div class="tab-pane fade show active" id="dashboard-pane" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>Energiebilanz</h3>
                        <div class="btn-group" role="group" id="period-selector">
                            <button type="button" class="btn btn-outline-primary active"
                                data-period="week">Woche</button>
                            <button type="button" class="btn btn-outline-primary" data-period="day">Tag</button>
                            <button type="button" class="btn btn-outline-primary" data-period="month">Monat</button>
                            <button type="button" class="btn btn-outline-primary" data-period="year">Jahr</button>
                        </div>
                    </div>
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="card dashboard-card p-3 text-center">
                                <h5 class="text-success">Aufgenommen</h5>
                                <p id="total-in" class="fs-2 mb-0">0 kcal</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card dashboard-card p-3 text-center">
                                <h5 id="balance-title" class="text-info">Bilanz</h5>
                                <p id="total-balance" class="fs-2 mb-0">0 kcal</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card dashboard-card p-3 text-center">
                                <h5 class="text-danger">Verbraucht</h5>
                                <p id="total-out" class="fs-2 mb-0">0 kcal</p>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card dashboard-card p-3"><canvas id="energy-chart"></canvas></div>
                        </div>
                    </div>
                </div>
                <!-- Data Table Tabs -->
                <div class="tab-pane fade" id="foods-pane" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center my-3">
                        <h3>Ihre Nahrungsmittel</h3><button class="btn btn-success" data-action="open-modal"
                            data-entity="foods"><i class="bi bi-plus-lg"></i> Hinzufügen</button>
                    </div><data-table entity="foods"
                        columns='[{"key": "name", "label": "Name"}, {"key": "calories_per_100g", "label": "Kalorien / 100g"}]'></data-table>
                </div>
                <div class="tab-pane fade" id="exercises-pane" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center my-3">
                        <h3>Ihre Bewegungsformen</h3><button class="btn btn-success" data-action="open-modal"
                            data-entity="exercisetypes"><i class="bi bi-plus-lg"></i> Hinzufügen</button>
                    </div><data-table entity="exercisetypes"
                        columns='[{"key": "name", "label": "Name"}, {"key": "calories_per_hour", "label": "Kalorien / Stunde"}]'></data-table>
                </div>
                <div class="tab-pane fade" id="consumptions-pane" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center my-3">
                        <h3>Ihr Konsum</h3><button class="btn btn-success" data-action="open-modal"
                            data-entity="consumptionlogs"><i class="bi bi-plus-lg"></i> Protokollieren</button>
                    </div><data-table entity="consumptionlogs"
                        columns='[{"key": "log_date", "label": "Datum", "format": "datetime"}, {"key": "food_name", "label": "Nahrungsmittel"}, {"key": "amount_g", "label": "Menge (g)"}]'></data-table>
                </div>
                <div class="tab-pane fade" id="activities-pane" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center my-3">
                        <h3>Ihre Aktivitäten</h3><button class="btn btn-success" data-action="open-modal"
                            data-entity="activitylogs"><i class="bi bi-plus-lg"></i> Protokollieren</button>
                    </div><data-table entity="activitylogs"
                        columns='[{"key": "log_date", "label": "Datum", "format": "datetime"}, {"key": "exercise_name", "label": "Bewegung"}, {"key": "duration_min", "label": "Dauer (min)"}]'></data-table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for Create/Edit -->
    <div class="modal fade" id="item-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal-title">Element</h5><button type="button" class="btn-close"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-form"></form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Abbrechen</button><button type="button" class="btn btn-primary"
                        id="modal-save-btn">Speichern</button></div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for Delete -->
    <div class="modal fade" id="confirm-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bestätigung</h5><button type="button" class="btn-close"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="confirm-message">Möchten Sie dies wirklich tun?</p>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Abbrechen</button><button type="button" class="btn btn-danger"
                        id="confirm-btn">Löschen</button></div>
            </div>
        </div>
    </div>

    <!-- External JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Internal JS Modules with static paths -->
    <script src="/static/js/api.js" type="module"></script>
    <script src="/static/js/ui.js" type="module"></script>
    <script src="/static/js/DataTable.js" type="module"></script>
    <script src="/static/js/app.js" type="module"></script>
</body>

</html>